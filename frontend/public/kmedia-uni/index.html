<!DOCTYPE html>
<html lang="en" style="width: 100%;height: 100%;">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="./kmedia-uni.js"></script>
  <style>
    #app {
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body style="margin: 0px;width: 100%;height: 100%;">
  <div id="app"></div>
  <script>
    const defaultValue = {
      websocketUrl: 'ws://2.40.54.28',
      devId: '32050800001326000009',
      nmediaId: '',
      startTime: '2021-06-04T00:00:00',
      endTime: '2021-06-05T00:00:00'
    };

    var url = window.location.search
    var theRequest = new Object();
    // 判断是否有问号
    if (url.indexOf("?") != -1) {
      // 把问号去掉
      var str = url.substr(1);
      // 判断是否有多个参数
      if(str.indexOf("&") != -1) {
        // 以&符分项组成数组
        let strs = str.split("&");
        for (var i = 0; i < strs.length; i++) {
          // 循环数组
          // theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
          // 每一项等号左边为属性，等号右边为属性的值，值需要使用 decodeURI() 函数对通过 escape() 或 url 编码过的字符串进行解码。
          theRequest[strs[i].split("=")[0]] = decodeURI(strs[i].split("=")[1]);
        }
      } else {
        // 只有一个参数
        let arr = str.split("=");
        theRequest[arr[0]] = arr[1];
      }
    };
    defaultValue.devId = theRequest.device_id

    console.log('theRequest',theRequest,defaultValue)

    const MODE = KMediaUni.MODE;
    let timer = null;
    let player = new KMediaUni({
      selector: '#app',
			loading: true,
			showMessage: true,
			control: {
				hideControlsBar: false,
				tools: Object.values(KMediaUni.TOOLS)
			}
    });;

    function loadVideo (isLive) {
      player.loadVideo({
        src: {
          ...defaultValue,
          ...(
            isLive
              ? {
                startTime: undefined,
                endTime: undefined
              }
              : {}
          )
        },
        autoplay:true
      });
    }
    loadVideo(true)

    function startLoopVideo () {
      timer = setInterval(() => {
        loadVideo(true)
      }, 200);
    }

    function stopLoopVideo () {
      timer && clearInterval(timer)
    }

    function exec (cmd, ...args) {
      if (player && player[cmd]) {
        player[cmd](...args);
      } else {
        console.error('not find', cmd);
      }
    }
  </script>
</body>
</html>